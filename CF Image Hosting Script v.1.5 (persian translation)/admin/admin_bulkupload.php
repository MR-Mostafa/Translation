<?php/************************************************************************************************************** * *   CF Image Hosting Script *   --------------------------------- * *   Author:    codefuture.co.uk *   Version:   1.5 *   Date:       07 March 2012 * *   You can download the latest version from: http://codefuture.co.uk/projects/imagehost/ * *   Copyright (c) 2010-2012 CodeFuture.co.uk *   This file is part of the CF Image Hosting Script. * *   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, *   EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, *   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR *   COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, *   WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF *   OR  IN  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE. * * *   You may not modify and/or remove any copyright notices or labels on the software on each *   page (unless full license is purchase) and in the header of each script source file. * *   You should have received a full copy of the LICENSE AGREEMENT along with *   Codefuture Image Hosting Script. If not, see http://codefuture.co.uk/projects/imagehost/license/. * * *   ABOUT THIS PAGE ----- *   Used For:     Admin Bulk image uploader *   Last edited:  07/03/2012 * *************************************************************************************************************/ /* * check page is being loaded from within the admin.php page * If not send user back admin login page */	if(!isset($admin_page) && $admin_page){		header('Location: ../admin.php');		exit();	}	// check for errors coming from other pages	if(isset($_SESSION['err'])){		$Err = $_SESSION['err'];		unset($_SESSION['err']);	}// check for uploaded image to show	if(isset($_SESSION['upload'])){		$countThumb	= 0; // count number of thumb's on page		$thumbHtml	= ''; // hold thumbnail page html	// image loop		foreach($_SESSION['upload'] as $k=>$uploadimage){			if(isset($uploadimage['id']))$img_id =$uploadimage['id'];			unset($_SESSION['upload'][$k]);			if(isset($img_id) && preg_replace("/[^0-9A-Za-z]/","",$img_id) == $img_id){			//see if image exists				if ($image = getImage($img_id)){				// Thumbnail page variables					$thumb_link		= imageAddress(3,$image,'pt');					$thumb_url		= imageAddress(3,$image,'dt');					$thumb_mid_link	= imageAddress(2,$image,'pm');					$thumb_mid_url	= imageAddress(2,$image,'dm');					$imgurl			= imageAddress(1,$image,'di');					$alt			= $image['alt'];					$shorturl		= $image['shorturl'];					$bookmarking	= bookmarking(($shorturl ==null?$thumb_mid_link:$shorturl),$alt);				// make image links					$links[$countThumb] = array(										'thumb_bbcode'			=> imageLinkCode('bbcode',$thumb_url,$thumb_link),										'thumb_html'				=> imageLinkCode('html',$thumb_url,$thumb_link,$alt),										'thumb_mid_bbcode'	=> imageLinkCode('bbcode',$thumb_mid_url,$thumb_mid_link),										'thumb_mid_html'		=> imageLinkCode('html',$thumb_mid_url,$thumb_mid_link,$alt),										'image_bbcode'			=> imageLinkCode('bbcode',$imgurl),										'image_direct'			=> $imgurl,										'delete_url'				=> (isset($delete_id)?$settings['SET_SITEURL'].'/?d='.$delete_id:'')										);				//image box					$thumbHtml .= '<div class="ibox imgedit_img"><h2 class="boxtitle">'.$alt.'</h2><a href="'.imageAddress(1,$image).'" title="'.$alt.'" id="fancybox" ><img src="'.imageAddress(3,$image).'" alt="'.$alt.'" /></a>';				//image links					$thumbHtml .= '<div class="code_box">'.$bookmarking.'</div>';				// end					$thumbHtml .= '</div>';				// links title					$thumbHtml .= '<div class="ibox imgedit_form"><h2 class="boxtitle">'.$lang["site_index_hide_link"].'</h2>';				// Short URL					if ($shorturl != null && !empty($shorturl))	$thumbHtml .= '										<div class="code_box"><label for="shorturl">'.$lang["site_index_short_url_link"].':</label> <input type="text" id="codehtml" value="'.$shorturl.'" onclick="javascript:this.focus();this.select();" readonly="true" class="text_input long" /></div>';				// Image Links					$thumbHtml .= '							<h3>'.$lang["site_index_small_thumbnail_link"].'</h3>								<div class="code_box"><label for="codelbb">'.$lang["site_index_bbcode"].':</label> <input type="text" id="codelbb" value="'.$links[$countThumb]['thumb_bbcode'].'" onclick="javascript:this.focus();this.select();" readonly="true" class="text_input long" /></div>								<div class="code_box"><label for="codehtml"><a href="'.$thumb_link.'" title="'.$alt.'" >'.$lang["site_index_html_code"].'</a> :</label> <input type="text" id="codehtml" value="'.$links[$countThumb]['thumb_html'].'" onclick="javascript:this.focus();this.select();" readonly="true" class="text_input long" /></div>							<h3>'.$lang["site_index_thumbnail_link"].'</h3>								<div class="code_box"><label for="codelbb">'.$lang["site_index_bbcode"].':</label> <input type="text" id="codelbb" value="'.$links[$countThumb]['thumb_mid_bbcode'].'" onclick="javascript:this.focus();this.select();" readonly="true" class="text_input long" /></div>								<div class="code_box"><label for="codehtml"><a href="'.$thumb_mid_link.'" title="'.$alt.'" >'.$lang["site_index_html_code"].'</a> :</label> <input type="text" id="codehtml" value="'.$links[$countThumb]['thumb_mid_html'].'" onclick="javascript:this.focus();this.select();" readonly="true" class="text_input long" /></div>							<h3>'.$lang["site_index_image_link"].'</h3>							<div class="code_box"><label for="codebb">'.$lang["site_index_bbcode"].':</label> <input type="text" id="codebb" value="'.$links[$countThumb]['image_bbcode'].'" onclick="javascript:this.focus();this.select();" readonly="true" class="text_input long" /></div>							<div class="code_box"><label for="codedirect">'.$lang["site_index_direct_link"].'</label> <input type="text" id="codedirect" value="'.$links[$countThumb]['image_direct'].'" onclick="javascript:this.focus();this.select();" readonly="true" class="text_input long" /></div>';					$thumbHtml .= '</div>';					$thumbHtml .= '<div style="clear: both;"></div>';				}else{					$Err['thumbs_page'] = $lang["site_index_thumbs_page_err"];				}			}			$countThumb++;		}// end uploaded loop	// unset upload array		unset($_SESSION['upload']);	} // end show uploaded images// make image list to upload	if(isset($_POST['bupload'])) {		if ($handle = opendir($DIR_BULKUPLOAD)) {			$i = 0;			while (false !== ($file = readdir($handle))){				if ($file != "." && $file != ".."){					$path = $DIR_BULKUPLOAD;					if(is_file($path.$file)) {						$info = pathinfo($file);						if(in_array(strtolower($info['extension']),$imgFormats)){							$_FILES['file']['tmp_name'][$i] = $path.$file;							$_FILES['file']['name'][$i] = $file;							$_FILES['file']['size'][$i] = 0;							$i++;						}					} 				 }			}		}		if ($i > 0){		// upload images			$image['URL'] = $api = 1;			$admin_upload = true;			include('upload.php');		}else{			$Err['imgupload'] = sprintf($lang["admin_bulk_no_image_err"],$DIR_BULKUPLOAD);		}	}// page settings	$page['id']					= 'bulkupload';	$page['title']				= $lang["admin_bulk_title"];	$page['description']	= '';	$page['tipsy'] 			= true;	$page['fancybox']		= true;	require_once('admin/admin_page_header.php');?><!-- admin Bulk Upload -->			<div class="ibox full">				<h2><?php echo $lang["admin_bulk_title"];?></h2>				<p><?php echo sprintf($lang["admin_bulk_des"],$DIR_BULKUPLOAD);?></p>				<form method="POST" action="admin.php?act=bulk">					<div class="code_box"><input class="button button_cen" onclick="" type="submit" value="<?php echo $lang["admin_bulk_form_button"];?>" name="bupload" /></div>				</form>			</div>			<div class="clear"></div>			<?php echo (isset($thumbHtml)?$thumbHtml:'');?>		</div><?php	require_once('admin/admin_page_footer.php');	die();	exit;